# MapTimelineView  
# Googleマップのタイムラインをブラウザで表示  
  
・Googleマップの仕様変更によって現在ではタイムラインがPCのWebブラウザで見られなくなっています。  
・個人的に旅行先で撮影した写真のフォルダに行程のタイムラインのスクリーンショットも入れているのですが、スマホのスクリーンショットをPCにいちいち持ってくるのも面倒なので、Android端末からエクスポートした"タイムライン.json"ファイルをPCで表示するアプリを作りました。  
 ![screenshot1](https://github.com/user-attachments/assets/42aef86b-dcbc-4f5f-9c3f-0782bf7d0bd3)

・PCのブラウザではChrome, Edge, IEで、またFireタブレットでも動作することを確認しました。  
  
**●使い方**  
・Android端末から、設定/位置情報/位置情報サービス/タイムライン/[アカウントの選択]/タイムラインをエクスポート  
で"タイムライン.json"というファイルが書き出されるので、USB接続かGoogleドライブ経由などでPCに取り込みます。(Googleマップアプリからのエクスポートではないことに注意)  
・MapTimelineView.htmlをローカルPCにダウンロードして起動し、先ほどのjsonファイルを読み込んでカレンダーで希望する日付を選べばその日のタイムラインが表示されます。  
  
**●お勧め設定**  
・エクスポートされたjsonには、自宅と職場以外の場所の名称の情報は含まれていません。よってダウンロードしたhtmlのままではそれ以外の場所の名称は全て「訪問地点」と表示されます。そこでYahoo!の場所情報APIを使って検索を行い、場所の名称を確定できるようになっています。そのためには各人でYahoo!のクライアントIDを取得していただく必要があります。ID取得と利用は無料です。Yahoo!のアカウントは必要ですが。  
・こちらのリンクを参考にIDを取得して、  
>Client ID（アプリケーションID）を発行する  
https://support.yahoo-net.jp/PccDeveloper/s/article/H000006131  

ダウンロードしたhtmlをエディタで開いて、14行目あたりのconst APPIDに設定(""の間にペースト)してセーブしてください。(エンコードはUTF-8です。)  
  
**●機能**  
・カレンダーの日付部分に、その日の移動距離に応じたサイズの円を表示しています。  
・移動手段によりラインの色を変えています。徒歩なら黒の破線、車なら青、電車は紫、飛行機や船は赤などです。適宜ソースコードを編集してください。  
![screenshot2](https://github.com/user-attachments/assets/11b53cb2-55da-4bea-a489-9e6f7b92fc61)

  
**●その他**  
・Yahoo!の場所情報APIで得られる名称は、店舗の名前が多いようです。例えば駅名の"XX駅"が欲しいのに"エキュートXX"などがやってきます。そこで名称の先頭の代表的な店名と末尾が'店'なら文字を削除したり、名称そのものを置き換えています。必要に応じてソースコードを編集してください。  
・名称に関してはjsonファイルにGoogleのIDが記録されているので、GoogleのAPIを使えばIDから名称を得られるらしいのですが、こちらは300ドル分までが無料でそれを超えると課金されるとのことで手を出していません。  
・同じ理由で地図もオープンソースのOSMを使っています。OSMにも検索APIがあるのですが、ほとんど名称が得られないのとレスポンスが遅い(おそらく時間で頻度を制限されている)ので使いませんでした。  
  
**●jsonデータの構造について調べたことの覚え書き**  
・Android端末からエクスポートしたjsonとiPhone版とは異なるらしい。  
・"タイムライン.json"は3つのセグメントに分かれていて、  
1:semanticSegments  
→訪問地点(visit)、アクティビティ(activity)、タイムライン(timelinePath)などのデータ。  
2:rawSignals  
→1か月前までの生の位置情報と時刻、それをGPS/WIFI/CELLの誰からもらったかの区別。  
3:userLocationProfile  
→ユーザーが検索か保存した地点情報のID？  
  ![json_timechart](https://github.com/user-attachments/assets/52e9141f-104f-4863-b831-4eba207556dd)

・visitにはstart/end時刻と訪問場所の位置情報が1つ含まれている。  
・activityにはstart/end時刻と移動手段、start/end時それぞれの位置情報2つが含まれている。  
・timelinePathには時刻と位置の情報が複数含まれている。  
・時刻は現地時間となっている。  
・visit期間中にもtimelinePathの個別の位置情報は存在するがGoogleマップアプリのタイムライン表示には使われない。  
・visitやactivityは時間的に連続している。つまり何かのend時刻が次の何かのstart時刻。  
・visitが連続することもあるしactivityが連続することもある。  
・visitのend時刻は、次に出現するtimelinePathの個別の位置情報の時刻よりも後になることがある(全く移動しない日が連続した場合)。つまりデーターが時系列順に書き込まれているわけではない。  
以上  
